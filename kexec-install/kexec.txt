
# Install needed packages
dnf install -y wget kexec-tools

# Download fedora 27 pxeboot kernel and initrd
cd /
wget https://dl.fedoraproject.org/pub/fedora/linux/releases/27/Everything/x86_64/os/images/pxeboot/{initrd.img,vmlinuz}

# Download kickstart file (you can of course tune it)
wget https://raw.githubusercontent.com/champtar/notes/master/kexec-install/anaconda-ks.cfg -O ks.cfg

# Append ks.cfg to initrd.img
echo ks.cfg | cpio -c -o >> initrd.img

# Launch automated install
cd /
kexec -l vmlinuz --initrd=initrd.img --command-line="ip=dhcp inst.ks=file:/ks.cfg"
kexec -e

# Or launch vnc install
kexec -l vmlinuz --initrd=initrd.img --command-line="ip=dhcp inst.vnc inst.vncpassword=48ea6e5f inst.ks=file:/ks.cfg"

# don't forget to change luks password after first boot
cryptsetup luksChangeKey /dev/vda2

# see
https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/installation_guide/sect-kickstart-syntax
https://docs.fedoraproject.org/f27/install-guide/appendixes/Kickstart_Syntax_Reference.html
https://arrfab.net/posts/2015/May/06/hacking-initrdimg-for-fun-and-profit/

